(function(){this.Joosy={Modules:{},Resources:{},Templaters:{},Helpers:{},Events:{},debug:function(a){return null!=a?this.__debug=a:!!this.__debug},templater:function(a){if(null!=a)return this.__templater=a;if(!this.__templater)throw new Error("No templater registered");return this.__templater},namespace:function(a,b){var c,d,e,f,g,h,i;for(null==b&&(b=!1),a=a.split("."),f=window,g=0,h=a.length;h>g;g++)e=a[g],e.length>0&&(f=null!=f[e]?f[e]:f[e]={});b&&(b=b.apply(f)),i=[];for(c in f)d=f[c],f.hasOwnProperty(c)&&Joosy.Module.hasAncestor(d,Joosy.Module)?i.push(d.__namespace__=a):i.push(void 0);return i},helpers:function(a,b){var c;return(c=Joosy.Helpers)[a]||(c[a]={}),b.apply(Joosy.Helpers[a])},uid:function(){return this.__uid||(this.__uid=0),"__joosy"+this.__uid++},uuid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b,c;return b=0|16*Math.random(),c="x"===a?b:8|3&b,c.toString(16)}).toUpperCase()},synchronize:function(){var a;return Joosy.Modules.Events?(a=Joosy.Modules.Events).synchronize.apply(a,arguments):console.error("Events module is required to use `Joosy.synchronize'!")},buildUrl:function(a,b){var c,d;return d=[],Object.each(b,function(a,b){return d.push(""+a+"="+b)}),c=a.match(/(\#.*)?$/)[0],a=a.replace(/\#.*$/,""),d.isEmpty()||a.has(/\?/)||(a+="?"),d=d.join("&"),d.isBlank()||"?"===a.last()||(d="&"+d),a+d+c}},null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy",function(){return Joosy})}).call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Joosy.Module=function(){function a(){}return a.__namespace__=[],a.__className=function(a){return Object.isFunction(a)||(a=a.constructor),null!=a.name?a.name:a.toString().replace(/^function ([a-zA-Z]+)\([\s\S]+/,"$1")},a.hasAncestor=function(a,b){var c;if(null==a||null==b)return!1;for(a=a.prototype,b=b.prototype;a;){if(a===b)return!0;a=null!=(c=a.constructor)?c.__super__:void 0}return!1},a.aliasMethodChain=function(a,b,c){var d,e;return d=b.charAt(0).toUpperCase()+b.slice(1),e=""+a+"Without"+d,Object.isFunction(c)||(c=this.prototype[c]),this.prototype[e]=this.prototype[a],this.prototype[a]=c},a.aliasStaticMethodChain=function(a,b,c){var d,e;return d=b.charAt(0).toUpperCase()+b.slice(1),e=""+a+"Without"+d,this[e]=this[a],this[a]=c},a.merge=function(a,b,c){var d,e;null==c&&(c=!0);for(d in b)e=b[d],b.hasOwnProperty(d)&&(c||!a.hasOwnProperty(d))&&(a[d]=e);return a},a.include=function(a){var b,c,d;if(!a)throw new Error("include(object) requires obj");for(b in a)c=a[b],"included"!==b&&"extended"!==b&&(this.prototype[b]=c);return null!=(d=a.included)&&d.apply(this),null},a.extend=function(a){var b;if(!a)throw new Error("extend(object) requires object");return this.merge(this,a),null!=(b=a.extended)&&b.apply(this),null},a}(),Joosy.Function=function(a){function c(a){var b,c,d;if(c=function(){return c.__call.apply(c,arguments)},c.__proto__)c.__proto__=this;else for(b in this)d=this[b],c[b]=d;return c.constructor=this.constructor,null!=a&&a.call(c),c}return b(c,a),c}(Joosy.Module),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/module",function(){return Joosy.Module})}.call(this),function(){var a,b,c=[].slice;b=function(){function a(){this.actions=[]}return a.prototype["do"]=function(a){return this.actions.push(a)},a.prototype.after=function(a){this.after=a},a}(),a=function(){function a(a){this.parent=a,this.bindings=[]}return a.prototype.bind=function(){var a,b;return a=1<=arguments.length?c.call(arguments,0):[],this.bindings.push((b=this.parent).bind.apply(b,a))},a.prototype.unbind=function(){var a,b,c,d;for(d=this.bindings,b=0,c=d.length;c>b;b++)a=d[b],this.parent.unbind(a);return this.bindings=[]},a}(),Joosy.Modules.Events={eventsNamespace:function(b){var c;return c=new a(this),null!=b&&"function"==typeof b.call&&b.call(c),c},wait:function(a,b,c){return this.hasOwnProperty("__oneShotEvents")||(this.__oneShotEvents={}),Object.isFunction(b)&&(c=b,b=a,a=Object.keys(this.__oneShotEvents).length.toString()),b=this.__splitEvents(b),b.length>0?this.__oneShotEvents[a]=[b,c]:c(),a},unwait:function(a){return this.hasOwnProperty("__oneShotEvents")?delete this.__oneShotEvents[a]:void 0},bind:function(a,b,c){return this.hasOwnProperty("__boundEvents")||(this.__boundEvents={}),Object.isFunction(b)&&(c=b,b=a,a=Object.keys(this.__boundEvents).length.toString()),b=this.__splitEvents(b),b.length>0?this.__boundEvents[a]=[b,c]:c(),a},unbind:function(a){return this.hasOwnProperty("__boundEvents")?delete this.__boundEvents[a]:void 0},trigger:function(){var a,b,d,e,f,g,h,i,j,k,l,m=this;if(d=arguments[0],b=2<=arguments.length?c.call(arguments,1):[],Joosy.Modules.Log.debugAs(this,"Event "+d+" triggered"),Object.isObject(d)?(h=d.remember,d=d.name):h=!1,this.hasOwnProperty("__oneShotEvents")){f=[],i=this.__oneShotEvents;for(g in i)j=i[g],e=j[0],a=j[1],e.remove(d),0===e.length&&f.push(g);f.each(function(c){return a=m.__oneShotEvents[c][1],delete m.__oneShotEvents[c],a.apply(null,b)})}if(this.hasOwnProperty("__boundEvents")){k=this.__boundEvents;for(g in k)l=k[g],e=l[0],a=l[1],e.any(d)&&a.apply(null,b)}return h?(this.hasOwnProperty("__triggeredEvents")||(this.__triggeredEvents={}),this.__triggeredEvents[d]=!0):void 0},synchronize:function(a){var c,d,e=this;return c=new b,d=0,a(c),0===c.actions.length?c.after.call(this):c.actions.each(function(a){return a.call(e,function(){return++d>=c.actions.length?c.after.call(this):void 0})})},__splitEvents:function(a){var b=this;return Object.isString(a)&&(a=a.isBlank()?[]:a.trim().split(/\s+/)),this.hasOwnProperty("__triggeredEvents")&&(a=a.findAll(function(a){return!b.__triggeredEvents[a]})),a}},null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/modules/events",function(){return Joosy.Modules.Events})}.call(this),function(){var a=[].slice;Joosy.Modules.Log={log:function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],"undefined"!=typeof console&&null!==console?null!=console.log.apply?(b.unshift("Joosy>"),console.log.apply(console,b)):console.log(b.first()):void 0},debug:function(){var b;return b=1<=arguments.length?a.call(arguments,0):[],Joosy.debug()?this.log.apply(this,b):void 0},debugAs:function(){var b,c,d;return c=arguments[0],d=arguments[1],b=3<=arguments.length?a.call(arguments,2):[],Joosy.debug()?(c=Joosy.Module.__className(c)||"unknown context",this.debug.apply(this,[""+c+"> "+d].concat(a.call(b)))):void 0}},null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/modules/log",function(){return Joosy.Modules.Log})}.call(this),function(){Joosy.Modules.DOM={eventSplitter:/^(\S+)\s*(.*)$/,included:function(){return this.mapElements=function(a){return this.prototype.hasOwnProperty("__elements")||(this.prototype.__elements=Object.clone(this.__super__.__elements)||{}),Object.merge(this.prototype.__elements,a)},this.mapEvents=function(a){return this.prototype.hasOwnProperty("__events")||(this.prototype.__events=Object.clone(this.__super__.__events)||{}),Object.merge(this.prototype.__events,a)}},$:function(a,b){return $(a,b||this.$container)},__extractSelector:function(a){var b=this;return a=a.replace(/(\$[A-z0-9\.\$]+)/g,function(a){var c,d,e,f,g,h;for(a=a.split("."),c=a.pop(),e=b,f=0,g=a.length;g>f;f++)d=a[f],e=null!=e?e[d]:void 0;return null!=e?null!=(h=e[c])?h.selector:void 0:void 0}),a.trim()},__assignElements:function(a,b){var c,d,e;if(a||(a=this),b||(b=this.__elements),b){e=[];for(c in b)d=b[c],Object.isObject(d)?e.push(this.__assignElements(a["$"+c]={},d)):(d=this.__extractSelector(d),a["$"+c]=this.__wrapElement(d),e.push(a["$"+c].selector=d));return e}},__wrapElement:function(a){var b=this;return function(c){return c?b.$(a,c):b.$(a)}},__delegateEvents:function(){var a,b,c=this;return b=this,(a=this.__events)?Object.each(a,function(a,d){var e,f,g,h,i,j,k,l,m;for(l=a.split(","),m=[],j=0,k=l.length;k>j;j++)if(g=l[j],g=g.replace(/^\s+/,""),Object.isFunction(d)||(d=c[d]),e=function(a){return d.call(b,$(this),a)},h=g.match(c.eventSplitter),f=h[1],i=c.__extractSelector(h[2]),""===i)c.$container.bind(f,e),m.push(Joosy.Modules.Log.debugAs(c,""+f+" binded on container"));else{if(void 0===i)throw new Error("Unknown element "+h[2]+" in "+Joosy.Module.__className(c.constructor)+" (maybe typo?)");c.$container.on(f,i,e),m.push(Joosy.Modules.Log.debugAs(c,""+f+" binded on "+i))}return m}):void 0},__clearContainer:function(){return this.$container.unbind().off(),this.$container=$()}},null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/modules/dom",function(){return Joosy.Modules.DOM})}.call(this),function(){!function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w;return b=function(){},k=0,f=a.document,v=f&&"createRange"in f&&"undefined"!=typeof Range&&Range.prototype.createContextualFragment,n=f&&function(){var a;return a=f.createElement("div"),a.innerHTML="<div></div>",a.firstChild.innerHTML="<script></script>",""===a.firstChild.innerHTML}(),m=f&&function(){var a;return a=f.createElement("div"),a.innerHTML="Test: <script type='text/x-placeholder'></script>Value","Test:"===a.childNodes[0].nodeValue&&" Value"===a.childNodes[2].nodeValue}(),c=function(a){var d,e;return e=void 0,e=this instanceof c?this:new b,e.innerHTML=a,d="metamorph-"+k++,e.start=d+"-start",e.end=d+"-end",e},b.prototype=c.prototype,q=void 0,l=void 0,s=void 0,o=void 0,e=void 0,d=void 0,p=void 0,u=void 0,g=void 0,o=function(){return this.startTag()+this.innerHTML+this.endTag()},u=function(){return"<script id='"+this.start+"' type='text/x-placeholder'></script>"},g=function(){return"<script id='"+this.end+"' type='text/x-placeholder'></script>"},v?(q=function(a,b){var c,d,e;return e=f.createRange(),d=f.getElementById(a.start),c=f.getElementById(a.end),b?(e.setStartBefore(d),e.setEndAfter(c)):(e.setStartAfter(d),e.setEndBefore(c)),e},l=function(a,b){var c,d;return d=q(this,b),d.deleteContents(),c=d.createContextualFragment(a),d.insertNode(c)},s=function(){var a;return a=q(this,!0),a.deleteContents()},e=function(a){var b,c;return c=f.createRange(),c.setStart(a),c.collapse(!1),b=c.createContextualFragment(this.outerHTML()),a.appendChild(b)},d=function(a){var b,c,d;return d=f.createRange(),b=f.getElementById(this.end),d.setStartAfter(b),d.setEndAfter(b),c=d.createContextualFragment(a),d.insertNode(c)},p=function(a){var b,c,d;return c=f.createRange(),d=f.getElementById(this.start),c.setStartAfter(d),c.setEndAfter(d),b=c.createContextualFragment(a),c.insertNode(b)}):(w={select:[1,"<select multiple='multiple'>","</select>"],fieldset:[1,"<fieldset>","</fieldset>"],table:[1,"<table>","</table>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"],colgroup:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],map:[1,"<map>","</map>"],_default:[0,"",""]},h=function(a,b){var c,d,e,f;if(a.getAttribute("id")===b)return a;for(e=a.childNodes.length,d=void 0,f=void 0,c=void 0,d=0;e>d;){if(f=a.childNodes[d],c=1===f.nodeType&&h(f,b))return c;d++}},t=function(a,b){var c,d,e,g,i,j;if(e=[],m&&(b=b.replace(/(\s+)(<script id='([^']+)')/g,function(a,b,c,d){return e.push([d,b]),c})),a.innerHTML=b,e.length>0){for(d=e.length,c=void 0,c=0,j=[];d>c;)i=h(a,e[c][0]),g=f.createTextNode(e[c][1]),i.parentNode.insertBefore(g,i),j.push(c++);return j}},i=function(a,b){var c,d,e,g,h,i,j;for(c=w[a.tagName.toLowerCase()]||w._default,d=c[0],j=c[1],g=c[2],n&&(b="&shy;"+b),e=f.createElement("div"),t(e,j+b+g),h=0;d>=h;)e=e.firstChild,h++;if(n){for(i=e;1===i.nodeType&&!i.nodeName;)i=i.firstChild;3===i.nodeType&&"­"===i.nodeValue.charAt(0)&&(i.nodeValue=i.nodeValue.slice(1))}return e},r=function(a){for(;""===a.parentNode.tagName;)a=a.parentNode;return a},j=function(a,b){return a.parentNode!==b.parentNode?b.parentNode.insertBefore(a,b.parentNode.firstChild):void 0},l=function(a,b){var c,d,e,g,h,k,l;for(k=r(f.getElementById(this.start)),c=f.getElementById(this.end),h=c.parentNode,g=void 0,e=void 0,d=void 0,j(k,c),g=k.nextSibling;g;){if(e=g.nextSibling,d=g===c){if(!b)break;c=g.nextSibling}if(g.parentNode.removeChild(g),d)break;g=e}for(g=i(k.parentNode,a),l=[];g;)e=g.nextSibling,h.insertBefore(g,c),l.push(g=e);return l},s=function(){var a,b;return b=r(f.getElementById(this.start)),a=f.getElementById(this.end),this.html(""),b.parentNode.removeChild(b),a.parentNode.removeChild(a)},e=function(a){var b,c,d;for(c=i(a,this.outerHTML()),b=void 0,d=[];c;)b=c.nextSibling,a.appendChild(c),d.push(c=b);return d},d=function(a){var b,c,d,e,g,h;for(b=f.getElementById(this.end),c=b.nextSibling,g=b.parentNode,d=void 0,e=void 0,e=i(g,a),h=[];e;)d=e.nextSibling,g.insertBefore(e,c),h.push(e=d);return h},p=function(a){var b,c,d,e,g,h;for(g=f.getElementById(this.start),e=g.parentNode,c=void 0,d=void 0,d=i(e,a),b=g.nextSibling,h=[];d;)c=d.nextSibling,e.insertBefore(d,b),h.push(d=c);return h}),c.prototype.html=function(a){return this.checkRemoved(),void 0===a?this.innerHTML:(l.call(this,a),this.innerHTML=a)},c.prototype.replaceWith=function(a){return this.checkRemoved(),l.call(this,a,!0)},c.prototype.remove=s,c.prototype.outerHTML=o,c.prototype.appendTo=e,c.prototype.after=d,c.prototype.prepend=p,c.prototype.startTag=u,c.prototype.endTag=g,c.prototype.isRemoved=function(){var a,b;return b=f.getElementById(this.start),a=f.getElementById(this.end),!b||!a},c.prototype.checkRemoved=function(){if(this.isRemoved())throw new Error("Cannot perform operations on a Metamorph that is not in the DOM.")},a.Metamorph=c}(this)}.call(this),function(){var a=[].slice;Joosy.Modules.Renderer={included:function(){return this.view=function(a,b){return null==b&&(b={}),this.prototype.__view=a,this.prototype.__renderDefault=function(c){return null==c&&(c={}),b.dynamic?this.renderDynamic(a,c):this.render(a,c)}},this.helper=function(){var b,c;return b=1<=arguments.length?a.call(arguments,0):[],this.prototype.hasOwnProperty("__helpers")||(this.prototype.__helpers=(null!=(c=this.__super__.__helpers)?c.clone():void 0)||[]),this.prototype.__helpers=this.prototype.__helpers.add(b).unique(),this.prototype.__helpers=this.prototype.__helpers.unique()}},render:function(a,b,c){return null==b&&(b={}),null==c&&(c=!1),this.__render(!1,a,b,c)},renderDynamic:function(a,b,c){return null==b&&(b={}),null==c&&(c=!1),this.__render(!0,a,b,c)},__assignHelpers:function(){var a=this;if(null!=this.__helpers)return this.hasOwnProperty("__helpers")||(this.__helpers=this.__helpers.clone()),this.__helpers.each(function(b,c){if(!Object.isObject(b)){if(null==a[b])throw new Error("Cannot find method '"+b+"' to use as helper");return a.__helpers[c]={},a.__helpers[c][b]=function(){return a[b].apply(a,arguments)}}})},__instantiateHelpers:function(){var a,b,c,d;if(!this.__helpersInstance&&(this.__assignHelpers(),this.__helpersInstance={},this.__helpersInstance.__renderer=this,Joosy.Module.merge(this.__helpersInstance,Joosy.Helpers.Application),null!=Joosy.Helpers.Routes&&Joosy.Module.merge(this.__helpersInstance,Joosy.Helpers.Routes),this.__helpers))for(d=this.__helpers,b=0,c=d.length;c>b;b++)a=d[b],Joosy.Module.merge(this.__helpersInstance,a);return this.__helpersInstance},__instantiateRenderers:function(a){var b=this;return{render:function(c,d){return null==d&&(d={}),b.render(c,d,a)},renderDynamic:function(c,d){return null==d&&(d={}),b.renderDynamic(c,d,a)},renderInline:function(c,d){var e;return null==c&&(c={}),e=function(a){return d.apply(a)},b.renderDynamic(e,c,a)}}},__render:function(a,b,c,d){var e,f,g,h,i,j,k,l,m=this;if(null==c&&(c={}),null==d&&(d=!1),k=this.__renderingStackChildFor(d),k.template=b,k.locals=c,Object.isString(b))null!=this.__renderSection&&(b=Joosy.templater().resolveTemplate(this.__renderSection(),b,this)),b=Joosy.templater().buildView(b);else if(!Object.isFunction(b))throw new Error(""+Joosy.Module.__className(this)+"> template (maybe @view) does not look like a string or lambda");if(!Object.isObject(c)&&Object.extended().constructor!==c.constructor)throw new Error(""+Joosy.Module.__className(this)+"> locals (maybe @data?) is not a hash");if(f=function(){var a;return a={},Joosy.Module.merge(a,k.locals),Joosy.Module.merge(a,m.__instantiateHelpers(),!1),Joosy.Module.merge(a,m.__instantiateRenderers(k)),a},j=function(){return b(f())},a){h=Metamorph(j()),l=function(){var a,b,c,d,e,f,g,i,l,n,o;if(h.isRemoved()){for(i=h.__bindings,o=[],d=0,f=i.length;f>d;d++)l=i[d],c=l[0],a=l[1],o.push(c.unbind(a));return o}for(n=k.children,e=0,g=n.length;g>e;e++)b=n[e],m.__removeMetamorphs(b);return k.children=[],h.html(j())},l=l.debounce(0);for(g in c)i=c[g],c.hasOwnProperty(g)&&null!=(null!=i?i.bind:void 0)&&null!=(null!=i?i.unbind:void 0)&&(e=[i,i.bind("changed",l)],k.metamorphBindings.push(e));return h.__bindings=k.metamorphBindings,h.outerHTML()}return j()},__renderingStackElement:function(a){return null==a&&(a=null),{metamorphBindings:[],locals:null,template:null,children:[],parent:a}},__renderingStackChildFor:function(a){var b;return this.__renderingStack||(this.__renderingStack=[]),a?(b=this.__renderingStackElement(a),a.children.push(b),b):(b=this.__renderingStackElement(),this.__renderingStack.push(b),b)},__removeMetamorphs:function(a){var b,c,d=this;return null==a&&(a=!1),b=function(a){var b,c,e,f,g,h,i,j,k,l;if(null!=a?a.children:void 0)for(j=a.children,f=0,h=j.length;h>f;f++)c=j[f],d.__removeMetamorphs(c);if(null!=a?a.metamorphBindings:void 0){for(k=a.metamorphBindings,g=0,i=k.length;i>g;g++)l=k[g],e=l[0],b=l[1],e.unbind(b);return a.metamorphBindings=[]}},a?b(a):null!=(c=this.__renderingStack)?c.each(function(a){return b(a)}):void 0}},null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/modules/renderer",function(){return Joosy.Modules.Renderer})}.call(this),function(){Joosy.Modules.TimeManager={setTimeout:function(a,b){var c;return this.__timeouts||(this.__timeouts=[]),c=window.setTimeout(function(){return b()},a),this.__timeouts.push(c),c},setInterval:function(a,b){var c;return this.__intervals||(this.__intervals=[]),c=window.setInterval(function(){return b()},a),this.__intervals.push(c),c},clearTimeout:function(a){return window.clearTimeout(a)},clearInterval:function(a){return window.clearInterval(a)},__clearTime:function(){var a,b,c,d,e,f,g,h;if(this.__intervals)for(f=this.__intervals,b=0,d=f.length;d>b;b++)a=f[b],window.clearInterval(a);if(this.__timeouts){for(g=this.__timeouts,h=[],c=0,e=g.length;e>c;c++)a=g[c],h.push(window.clearTimeout(a));return h}}},null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/modules/time_manager",function(){return Joosy.Modules.TimeManager})}.call(this),function(){var a=[].slice;Joosy.Modules.Filters={included:function(){var b=this;return this.__registerFilterCollector=function(a){return b[a]=function(b){return this.prototype.hasOwnProperty("__"+a+"s")||(this.prototype["__"+a+"s"]=[].concat(this.__super__["__"+a+"s"]||[])),this.prototype["__"+a+"s"].push(b)},a.charAt(0).toUpperCase()+a.slice(1)},this.registerPlainFilters=function(){var c;return c=1<=arguments.length?a.call(arguments,0):[],c.each(function(c){var d;return d=b.__registerFilterCollector(c),b.prototype["__run"+d+"s"]=function(){var b,d,e,f,g,h;if(d=1<=arguments.length?a.call(arguments,0):[],this["__"+c+"s"]){for(g=this["__"+c+"s"],h=[],e=0,f=g.length;f>e;e++)b=g[e],"function"!=typeof b&&(b=this[b]),h.push(b.apply(this,d));return h}},b.prototype["__confirm"+d+"s"]=function(){var b,d=this;return b=1<=arguments.length?a.call(arguments,0):[],this["__"+c+"s"]?this["__"+c+"s"].reduce(function(a,c){return"function"!=typeof c&&(c=d[c]),a&&c.apply(d,b)!==!1},!0):!0},b.prototype["__apply"+d+"s"]=function(){var b,d,e,f,g,h;if(d=arguments[0],e=2<=arguments.length?a.call(arguments,1):[],!this["__"+c+"s"])return d;for(h=this["__"+c+"s"],f=0,g=h.length;g>f;f++)b=h[f],"function"!=typeof b&&(b=this[b]),d=b.apply(this,[d].concat(e));return d}})},this.registerSequencedFilters=function(){var c;return c=1<=arguments.length?a.call(arguments,0):[],c.each(function(a){var c;return c=b.__registerFilterCollector(a),b.prototype["__run"+c+"s"]=function(b,c){var d,e;return this["__"+a+"s"]?(e=this["__"+a+"s"],d=this,1===e.length?e[0].apply(this,b.include(c)):Joosy.synchronize(function(a){return e.each(function(c){return a["do"](function(a){return c.apply(d,b.include(a))})}),a.after(c)})):c()}})}}},null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/modules/filters",function(){return Joosy.Modules.Filters})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Joosy.Widget=function(a){function c(a,b){this.params=a,this.previous=b}return b(c,a),c.include(Joosy.Modules.Log),c.include(Joosy.Modules.Events),c.include(Joosy.Modules.DOM),c.include(Joosy.Modules.Renderer),c.include(Joosy.Modules.TimeManager),c.include(Joosy.Modules.Filters),c.mapWidgets=function(a){return this.prototype.hasOwnProperty("__widgets")||(this.prototype.__widgets=Object.clone(this.__super__.__widgets)||{}),Object.merge(this.prototype.__widgets,a)},c.independent=function(){return this.prototype.__independent=!0},c.registerPlainFilters("beforeLoad","afterLoad","afterUnload"),c.registerSequencedFilters("beforePaint","paint","erase","fetch"),c.prototype.registerWidget=function(a,b){return Object.isString(a)&&(a=this.__normalizeSelector(a)),b=this.__normalizeWidget(b),b.__bootstrapDefault(this,a),b},c.prototype.unregisterWidget=function(a){return a.__unload()},c.prototype.replaceWidget=function(a,b){return b=this.__normalizeWidget(b),b.previous=a,b.__bootstrapDefault(this,a.$container),b},c.prototype.navigate=function(){var a;return null!=(a=Joosy.Router)?a.navigate.apply(a,arguments):void 0},c.prototype.__renderSection=function(){return"widgets"},c.prototype.__nestingMap=function(){var a,b,c,d;a={},d=this.__widgets;for(b in d)c=d[b],c=this.__normalizeWidget(c),a[b]={instance:c,nested:c.__nestingMap()};return a},c.prototype.__bootstrapDefault=function(a,b){return this.__bootstrap(a,this.__nestingMap(),b)},c.prototype.__bootstrap=function(a,b,c,d){var e=this;return this.$container=c,null==d&&(d=!0),this.wait("section:fetched section:erased",function(){return e.__runPaints([],function(){return e.__paint(a,b,e.$container)})}),this.__erase(),d?this.__fetch(b):void 0},c.prototype.__fetch=function(a){var b=this;return this.data={},this.synchronize(function(c){return Object.each(a,function(a,b){return b.instance.__fetch(b.nested),b.instance.__independent?void 0:c["do"](function(a){return b.instance.wait("section:fetched",a)})}),c["do"](function(a){return b.__runFetchs([],a)}),c.after(function(){return b.trigger({name:"section:fetched",remember:!0})})})},c.prototype.__erase=function(){var a=this;return null!=this.previous?this.previous.__runErases([],function(){return a.previous.__unload(),a.__runBeforePaints([],function(){return a.trigger({name:"section:erased",remember:!0})})}):this.__runBeforePaints([],function(){return a.trigger({name:"section:erased",remember:!0})})},c.prototype.__paint=function(a,b,c){var d=this;return this.parent=a,this.$container=c,this.__nestedSections=[],this.$container.html("function"==typeof this.__renderDefault?this.__renderDefault(this.data||{}):void 0),this.__load(),Object.each(b,function(a,b){var e;return c=d.__normalizeSelector(a),!b.instance.__independent||(null!=(e=b.instance.__triggeredEvents)?e["section:fetched"]:void 0)?b.instance.__paint(d,b.nested,c):b.instance.__bootstrap(d,b.nested,c,!1)})},c.prototype.__load=function(){var a;return this.parent&&((a=this.parent).__nestedSections||(a.__nestedSections=[]),this.parent.__nestedSections.push(this)),this.__assignElements(),this.__delegateEvents(),this.__runAfterLoads()},c.prototype.__unload=function(a){var b,c,d,e;if(null==a&&(a=!0),this.__nestedSections){for(e=this.__nestedSections,c=0,d=e.length;d>c;c++)b=e[c],b.__unload(!1);delete this.__nestedSections}return this.__clearContainer(),this.__clearTime(),this.__removeMetamorphs(),this.__runAfterUnloads(),this.parent&&a&&this.parent.__nestedSections.splice(this.parent.__nestedSections.indexOf(this),1),delete this.previous,delete this.parent},c.prototype.__normalizeSelector=function(a){return"$container"===a?this.$container:$(this.__extractSelector(a),this.$container)},c.prototype.__normalizeWidget=function(a){return Object.isFunction(a)&&!Joosy.Module.hasAncestor(a,Joosy.Widget)&&(a=a.call(this)),Joosy.Module.hasAncestor(a,Joosy.Widget)&&(a=new a),a},c}(Joosy.Module),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/widget",function(){return Joosy.Widget})}.call(this),function(){Joosy.helpers("Application",function(){var a,b;return b=document.createTextNode("test"),a=document.createElement("span"),a.appendChild(b),this.escapeOnce=function(c){return b.nodeValue=c,a.innerHTML},this.tag=function(a,b,c,d){var e,f,g,h;null==b&&(b={}),null==c&&(c=!1),null==d&&(d=!0),e=document.createElement(a),g=document.createElement("div");for(a in b)h=b[a],d&&(h=this.escapeOnce(h)),e.setAttribute(a,h);return g.appendChild(e),f=g.innerHTML,c&&(f=f.replace("/>",">")),f},this.contentTag=function(a,b,c,d){var e,f,g,h,i;null==b&&(b=null),null==c&&(c=null),null==d&&(d=!0),Object.isString(b)?(c||(c={}),e=b):Object.isObject(b)?(Object.isFunction(c)?(d=!0,e=c()):(d=c,e=d()),c=b):(c={},e=b()),g=document.createElement(a),h=document.createElement("div");for(a in c)i=c[a],d&&(i=this.escapeOnce(i)),g.setAttribute(a,i);try{g.innerHTML=e}catch(j){if(f=j,e)throw f}return h.appendChild(g),h.innerHTML},this.renderWrapped=function(a,b){return this.render(a,Joosy.Module.merge(this,{yield:b()}))}})}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Joosy.Layout=function(a){function c(a,b){this.params=a,this.previous=b,this.uid=Joosy.uid()}return b(c,a),c.helper("page"),c.prototype.page=function(a,b){return null==b&&(b={}),b.id=this.uid,Joosy.Helpers.Application.tag(a,b)},c.prototype.content=function(){return $("#"+this.uid)},c.prototype.__renderSection=function(){return"layouts"},c.prototype.__nestingMap=function(a){var b;return b=c.__super__.__nestingMap.call(this),b["#"+this.uid]={instance:a,nested:a.__nestingMap()},b},c.prototype.__bootstrapDefault=function(a,b){return this.__bootstrap(null,this.__nestingMap(a),b)},c}(Joosy.Widget),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/layout",function(){return Joosy.Layout})}.call(this),function(){Joosy.Modules.Page={}}.call(this),function(){Joosy.Modules.Page.Scrolling={included:function(){return this.scroll=function(a,b){return null==b&&(b={}),this.prototype.__scrollElement=a,this.prototype.__scrollSpeed=b.speed||500,this.prototype.__scrollMargin=b.margin||0},this.paint(function(a){return this.__scrollElement&&0!==this.__scrollSpeed&&this.__fixHeight(),a()}),this.afterLoad(function(){return this.__scrollElement?this.__performScrolling():void 0})},__performScrolling:function(){var a,b,c=this;return a=(null!=(b=$(this.__extractSelector(this.__scrollElement)).offset())?b.top:void 0)+this.__scrollMargin,Joosy.Modules.Log.debugAs(this,"Scrolling to "+this.__extractSelector(this.__scrollElement)),$("html, body").animate({scrollTop:a},this.__scrollSpeed,function(){return 0!==c.__scrollSpeed?c.__releaseHeight():void 0})},__fixHeight:function(){return $("html").css("min-height",$(document).height())},__releaseHeight:function(){return $("html").css("min-height","")}}}.call(this),function(){Joosy.Modules.Page.Title={title:function(a,b){return null==b&&(b=" / "),this.afterLoad(function(){var c;return c=Object.isFunction(a)?a.apply(this):a,Object.isArray(c)&&(c=c.join(b)),this.__previousTitle=document.title,document.title=c}),this.afterUnload(function(){return document.title=this.__previousTitle})}}}.call(this),function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b};Joosy.Page=function(a){function c(a,b){var c;this.params=a,this.previous=b,this.layoutShouldChange=(null!=(c=this.previous)?c.__layoutClass:void 0)!==this.__layoutClass,this.halted=!this.__confirmBeforeLoads(),this.layout=function(){var b,c;switch(!1){case!(this.layoutShouldChange&&this.__layoutClass):return new this.__layoutClass(a,null!=(b=this.previous)?b.layout:void 0);case!!this.layoutShouldChange:return null!=(c=this.previous)?c.layout:void 0}}.call(this),this.layoutShouldChange&&!this.layout&&(this.previous=this.previous.layout)}return b(c,a),c.layout=function(a){return this.prototype.__layoutClass=a},c.include(Joosy.Modules.Page.Scrolling),c.extend(Joosy.Modules.Page.Title),c.prototype.__renderSection=function(){return"pages"},c.prototype.__bootstrapDefault=function(a){var b;return this.__bootstrap(this.layout,this.__nestingMap(),(null!=(b=this.layout)?b.content():void 0)||a)},c}(Joosy.Widget),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/page",function(){return Joosy.Page})}.call(this),function(){Joosy.helpers("Routes",function(){return this.linkTo=function(a,b,c){var d,e;return null==a&&(a=""),null==b&&(b=""),null==c&&(c={}),Object.isFunction(c)&&(d=c,e=[a,b],b=e[0],c=e[1],a=d()),Joosy.Helpers.Application.contentTag("a",a,Joosy.Module.merge(c,{"data-joosy":!0,href:b}))}})}.call(this),function(){var a,b={}.hasOwnProperty,c=function(a,c){function d(){this.constructor=a}for(var e in c)b.call(c,e)&&(a[e]=c[e]);return d.prototype=c.prototype,a.prototype=new d,a.__super__=c.prototype,a};Joosy.Router=function(b){function d(){return a=d.__super__.constructor.apply(this,arguments)}var e;return c(d,b),d.extend(Joosy.Modules.Events),$(window).bind("popstate",function(a){return null!=window.history.loaded?d.trigger("popstate",a):window.history.loaded=!0}),$(document).on("click","a[data-joosy]",function(a){return a.preventDefault(),Joosy.Router.navigate(this.getAttribute("href"))}),e=function(){function a(a,b){this.__namespace=a,this.__alias=b}return a.run=function(b,c,d){var e;return null==c&&(c=""),null==d&&(d=""),e=new a(c,d),b.call(e)},a.prototype.match=function(a,b){var c;return null==b&&(b={}),null!=b.as&&(c=this.__alias?this.__alias+b.as.charAt(0).toUpperCase()+b.as.slice(1):b.as),a=this.__namespace+a,Joosy.Router.compileRoute(a,b.to,c)},a.prototype.root=function(a){return null==a&&(a={}),this.match("/",{to:a.to,as:a.as||"root"})},a.prototype.notFound=function(a){return null==a&&(a={}),this.match(404,{to:a.to})},a.prototype.namespace=function(b,c,d){var e;return null==c&&(c={}),Object.isFunction(c)&&(d=c,c={}),a.run(d,this.__namespace+b,null!=(e=c.as)?e.toString():void 0)},a}(),d.map=function(a,b){var c=this;return Object.each(a,function(a,d){return null!=b&&(a=b+"/"+a),Object.isFunction(d)||d.prototype?c.compileRoute(a,d):c.map(d,a)})},d.draw=function(a){return e.run(a)},d.setup=function(a,b,c){var d,e=this;return this.config=a,this.responder=b,null==c&&(c=!0),history.pushState||(this.config.prefix=this.config.hashSuffix,this.config.html5=!1),this.config.html5||(this.config.prefix=this.config.hashSuffix),(d=this.config).prefix||(d.prefix=""),this.config.html5?(this.config.prefix=("/"+this.config.prefix+"/").replace(/\/{2,}/g,"/"),this.listener=this.bind("popstate pushstate",function(){return e.respond(e.canonizeLocation())})):(this.config.prefix=this.config.prefix.replace(/^\#?\/?/,"").replace(/\/?$/,""),$(window).bind("hashchange.JoosyRouter",function(){return e.respond(e.canonizeLocation())})),c?this.respond(this.canonizeLocation()):void 0},d.reset=function(){return this.unbind(this.listener),$(window).unbind(".JoosyRouter"),this.restriction=!1,this.routes={}},d.restrict=function(a){this.restriction=a},d.navigate=function(a,b){var c;
null==b&&(b={}),c=a,this.config.html5?(this.config.prefix&&"/"===c[0]&&!c.match(RegExp("^"+this.config.prefix.replace(/\/$/,"")+"(/|$)"))&&(c=c.replace(/^\//,this.config.prefix)),history.pushState({},"",c),this.trigger("pushstate")):(this.config.prefix&&!c.match(RegExp("^#?/?"+this.config.prefix+"(/|$)"))&&(c=c.replace(/^\#?\/?/,""+this.config.prefix+"/")),location.hash=c)},d.canonizeLocation=function(){return this.config.html5?location.pathname.replace(RegExp("^("+this.config.prefix+"?)?/?"),"/")+location.search:location.hash.replace(RegExp("^#?/?("+this.config.prefix+"(/|$))?"),"/")},d.compileRoute=function(a,b,c){var d,e,f;return"404"===a.toString()?(this.wildcardAction=b,void 0):("/"===a[0]&&(a=a.substr(1)),d=a.replace(/\/{2,}/g,"/"),f={},d=d.replace(/\/:([^\/]+)/g,"/([^/]+)"),d=d.replace(/^\/?/,"^/?"),d=d.replace(/\/?$/,"/?$"),e=(a.match(/\/:[^\/]+/g)||[]).map(function(a){return a.substr(2)}),this.routes||(this.routes={}),this.routes[d]={to:b,capture:e,as:c},null!=c?this.defineHelpers(a,c):void 0)},d.respond=function(a){var b,c,d,e,f,g;if(Joosy.Modules.Log.debug("Router> Answering '"+a+"'"),this.restriction&&null===a.match(this.restriction))return this.trigger("restricted",a),void 0;f=a.split("?"),a=f[0],c=f[1],c=(null!=c?"function"==typeof c.split?c.split("&"):void 0:void 0)||[],g=this.routes;for(d in g)if(e=g[d],this.routes.hasOwnProperty(d)&&(b=a.match(new RegExp(d))))return this.responder(e.to,this.__grabParams(c,e,b)),this.trigger("responded",a),void 0;return null!=this.wildcardAction?(this.responder(this.wildcardAction,a),this.trigger("responded")):this.trigger("missed")},d.defineHelpers=function(a,b){var c;return c=function(b){var c,d;return c=a,null!=(d=a.match(/\/:[^\/]+/g))&&"function"==typeof d.each&&d.each(function(a){return c=c.replace(a.substr(1),b[a.substr(2)])}),Joosy.Router.config.html5?""+Joosy.Router.config.prefix+c:"#"+Joosy.Router.config.prefix+c},Joosy.helpers("Routes",function(){return this[""+b+"Path"]=c,this[""+b+"Url"]=function(a){return Joosy.Router.config.html5?""+location.origin+c(a):""+location.origin+location.pathname+c(a)}})},d.__grabParams=function(a,b,c){var d,e;return null==b&&(b=null),null==c&&(c=[]),d={},c.shift(),null!=b&&null!=(e=b.capture)&&e.each(function(a){return d[a]=decodeURIComponent(c.shift())}),a.each(function(a){var b,c,e;return a.isBlank()?void 0:(e=a.split("="),b=e[0],c=e[1],d[b]=c)}),d},d}.call(this,Joosy.Module),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/router",function(){return Joosy.Router})}.call(this),function(){Joosy.Templaters.JST=function(){function a(a){this.config=null!=a?a:{},null!=this.config.prefix&&this.config.prefix.length>0&&(this.prefix=this.config.prefix)}return a.prototype.buildView=function(a){var b,c,d,e,f;for(d=!1,b=this.prefix?[""+this.prefix+"/templates/"+a+"-"+("undefined"!=typeof I18n&&null!==I18n?I18n.locale:void 0),""+this.prefix+"/templates/"+a]:["templates/"+a+"-"+("undefined"!=typeof I18n&&null!==I18n?I18n.locale:void 0),"templates/"+a],e=0,f=b.length;f>e;e++)if(c=b[e],window.JST[c])return window.JST[c];throw new Error("Template '"+a+"' not found. Checked at: '"+b.join(", ")+"'")},a.prototype.resolveTemplate=function(a,b,c){var d,e,f;return b.startsWith("/")?b.substr(1):(d=(null!=(e=c.constructor)?null!=(f=e.__namespace__)?f.map("underscore"):void 0:void 0)||[],d.unshift(a),""+d.join("/")+"/"+b)},a}(),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/templaters/jst",function(){return Joosy.Templaters.JST})}.call(this),function(){Joosy.helpers("Application",function(){return this.widget=function(a,b,c){var d=this;return null==c&&(c=b,b={}),b.id=Joosy.uid(),this.__renderer.setTimeout(0,function(){return d.__renderer.registerWidget($("#"+b.id),c)}),this.tag(a,b)}})}.call(this),function(){}.call(this),function(){Joosy.Application=function(){function a(){}return a.Pages={},a.Layouts={},a.Controls={},a.initialized=!1,a.loading=!0,a.config={test:!1,debug:!1,templater:{prefix:""},router:{html5:!1,base:"",prefix:""}},a.initialize=function(a,b){var c=this;if(this.selector=a,null==b&&(b={}),this.initialized)throw new Error("Attempted to initialize Application twice");return null!=window.JoosyEnvironment&&Object.merge(this.config,window.JoosyEnvironment,!0),Object.merge(this.config,b,!0),this.config.test&&this.forceSandbox(),Joosy.templater(new Joosy.Templaters.JST(this.config.templater)),Joosy.debug(this.config.debug),Joosy.Router.setup(this.config.router,function(a,b){if(Joosy.Module.hasAncestor(a,Joosy.Page))return c.changePage(a,b);if(Object.isFunction(a))return a(b);throw new Error("Unknown kind of route action: "+a)}),this.initialized=!0},a.reset=function(){var a;return Joosy.Router.reset(),Joosy.templater(!1),Joosy.debug(!1),null!=(a=this.page)&&a.__unload(),delete this.page,this.loading=!0,this.initialized=!1},a.content=function(){return $(this.selector)},a.changePage=function(a,b){var c;return c=new a(b,this.page),c.halted?void 0:(c.layoutShouldChange&&c.layout?c.layout.__bootstrapDefault(c,this.content()):c.__bootstrapDefault(this.content()),this.page=c)},a.forceSandbox=function(){var a;return a=Joosy.uid(),this.selector="#"+a,$("body").append($("<div/>").attr("id",a).css({height:"0px",width:"0px",overflow:"hidden"}))},a}(),null!=("undefined"!=typeof define&&null!==define?define.amd:void 0)&&define("joosy/application",function(){return Joosy.Application})}.call(this),function(){}.call(this);